import Head from "next/head";
import Image from "next/image";
import styles from "../../styles/Home.module.css";
import Post from "../../components/Post";
import { useState, useEffect } from "react";
import Modal from "react-modal";
import MakePostButton from "../../components/MakePostButton";
import { useRouter } from "next/router";

export default function Home({ posts_prop }) {
    const [posts, setPosts] = useState(posts_prop);
    const [modalIsOpen, setModalIsOpen] = useState(false);
    const router = useRouter();
    const { filteruser } = router.query;

    function fetchPosts() {
        fetch(`http://localhost:5000/posts?byuser=${filteruser}`)
            .then((res) => res.json())
            .then((data) => setPosts(data));
    }
    return (
        <div className={styles.container}>
            <Head>
                <title>Create Next App</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <main className={styles.main}>
                {posts.map((p) => (
                    <Post
                        key={p.id}
                        {...p}
                        fetchPosts={fetchPosts}
                        setModalIsOpen={setModalIsOpen}
                    ></Post>
                ))}
                <Modal
                    isOpen={modalIsOpen}
                    onAfterOpen={() => {}}
                    ariaHideApp={false}
                    contentLabel="Example Modal"
                    style={{
                        overlay: {
                            position: "fixed",
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            backgroundColor: "rgba(255, 255, 255, 0.75)",
                        },
                        content: {
                            position: "absolute",
                            top: "25%",
                            left: "25%",
                            border: "1px solid #ccc",
                            background: "#fff",
                            overflow: "auto",
                            WebkitOverflowScrolling: "touch",
                            borderRadius: "4px",
                            outline: "none",
                            padding: "20px",
                            width: "50%",
                            height: "50%",
                        },
                    }}
                >
                    <div className="z-20 h-full flex items-center content-center justify-center">
                        <div>
                            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                                <svg
                                    class="h-6 w-6 text-green-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M5 13l4 4L19 7"
                                    ></path>
                                </svg>
                            </div>
                            <p>Successly bought access</p>
                        </div>
                    </div>
                </Modal>
            </main>
            <div className="fixed bottom-10 right-10">
                <MakePostButton fetchPosts={fetchPosts}></MakePostButton>
            </div>
        </div>
    );
}

Home.getInitialProps = async (context) => {
    const { filteruser } = context.query;
    //const res = await fetch(`http://localhost:5000/posts?byuser=${"sean"}`);
    const res = await fetch(
        `http://localhost:5000/posts?filteruser=${filteruser}`
    );

    const posts = await res.json();
    console.log(posts);

    console.log(filteruser);
    return {
        posts_prop: posts, // will be passed to the page component as props
    };
};
